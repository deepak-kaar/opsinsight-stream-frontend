<div class="pt-[40px] pl-[20px] pr-[20px] w-full">
  <div class="flex justify-end pb-[10px] gap-[10px]">
    <p-button (onClick)="createDatasource()">Create</p-button>
  </div>
  <p-card class="w-full">
    <div class="card">
      <div class="flex flex-col md:flex-row md:justify-between gap-3 mb-4">
        <div class="flex justify-between items-center md:block">
          <div>List of Datasource</div>
          <div class="block md:hidden">
            <p-button [outlined]="true" icon="pi pi-filter-slash" (click)="clearDatasourceTable(dt)"
              class="sm:w-auto" />
          </div>
        </div>

        <div class="flex flex-col sm:flex-row md:items-center md:justify-end gap-2 w-full md:w-auto">
          <div class="hidden md:block">
            <p-button [outlined]="true" icon="pi pi-filter-slash" (click)="clearDatasourceTable(dt)"
              class="sm:w-auto" />
          </div>
          <div class="w-full sm:w-auto">
            <p-iconField iconPosition="left" class="w-full sm:w-auto">
              <p-inputIcon>
                <i class="pi pi-search"></i>
              </p-inputIcon>
              <input pInputText type="text" [(ngModel)]="searchDatasourceValue" placeholder="Search" class="w-full" />
            </p-iconField>
          </div>
        </div>
      </div>

      <p-table class="customizePaginator" #dt [value]="datasource_data$ | async" selectionMode="single"
        [(selection)]="selectedDatasource" dataKey="sysId" [rowHover]="true" [rows]="3"
        [showCurrentPageReport]="(isMobile$ | async) == true ? false : true" [rowsPerPageOptions]="[3, 5, 10]"
        [loading]="iSDatasourceloading" [paginator]="true" [responsive]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [filterDelay]="0"
        (onRowSelect)="onDataSourceSelect($event)" [globalFilterFields]="['sysId', 'sysName', 'sysType', 'decription']"
        styleClass="p-datatable-sm p-datatable-gridlines" [paginatorStyleClass]="'p-paginator-responsive'"
        [paginatorDropdownAppendTo]="'body'">
        <ng-template #header>
          <tr>
            <th pSortableColumn="sysId" class="hidden sm:table-cell">
              <div class="flex justify-between items-center">
                System Id
                <p-sortIcon field="sysId" />
              </div>
            </th>
            <th pSortableColumn="sysName" class="hidden sm:table-cell">
              <div class="flex justify-between items-center">
                System Name
                <p-sortIcon field="sysName" />
              </div>
            </th>
            <th pSortableColumn="sysType" class="hidden sm:table-cell">
              <div class="flex justify-between items-center">
                System Type
                <p-sortIcon field="sysType" />
              </div>
            </th>
            <th pSortableColumn="active">
              <div class="flex justify-between items-center">
                Status
                <p-sortIcon field="active" />
              </div>
            </th>
            <th>
              <div class="flex justify-center items-center">Actions</div>
            </th>
          </tr>
        </ng-template>

        <ng-template #body let-data>
          <tr [pSelectableRow]="data">
            <td>
              <span class="font-medium">{{ data.sysId }}</span>
            </td>
            <td>
              <span class="font-medium">{{ data.sysName }}</span>
            </td>
            <td class="hidden sm:table-cell">
              {{ data.sysType }}
            </td>
            <td>
              <p-tag [value]="getStatus(data.active)" [severity]="getSeverity(data.active)" />
            </td>
            <td>
              <div class="flex justify-center gap-2">
                <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" size="small"
                  (click)="deleteDatasource(data)" />
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="5" class="text-center py-4">No Datasource found.</td>
          </tr>
        </ng-template>

        <!-- Custom paginator template -->
        <ng-template pTemplate="paginatorleft">
          <div class="hidden sm:block text-sm text-gray-600">
            <!-- Showing {{dt.first + 1}} to {{dt.first + dt.rows > dt.totalRecords ? dt.totalRecords : dt.first + dt.rows}} of {{dt.totalRecords}} entries -->
          </div>
        </ng-template>
      </p-table>
    </div>
  </p-card>

  @if(isShowDetails){
  <p-card class="w-full pb-[30px]">
    <div class="flex w-full justify-end pb-[20px]">
      <p-button label="update" (onClick)="editDatasource(selectedDatasource)"></p-button>
    </div>
    <form [formGroup]="updateDataSourceForm" class="flex flex-col gap-[10px]">
      <div class="grid md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="sysId">System Id<span class="text-[var(--p-red-500)]"> *</span></label>
          <input formControlName="sysId" pInputText id="sysId" aria-describedby="username-help" />
        </div>
        <div class="flex flex-col gap-2">
          <label for="sysName">System Name<span class="text-[var(--p-red-500)]"> *</span></label>
          <input formControlName="sysName" pInputText id="sysName" aria-describedby="username-help" />
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="sysType">System Type</label>
          <p-select formControlName="sysType" [options]="systemTypes" placeholder="Select System Type" class="w-full"
            [filter]="true" appendTo="body" />
        </div>

        <div class="flex flex-col gap-2">
          <label for="operatingFacility">Operating Facility</label>
          <input pInputText formControlName="operatingFacility" id="operatingFacility"
            aria-describedby="username-help" />
        </div>
      </div>

      <div class="grid grid-cols-1 gap-4">
        <div class="flex flex-col gap-2">
          <label for="description">System Description</label>
          <textarea rows="3" cols="30" pTextarea formControlName="description" id="description"
            class="input-field"></textarea>
        </div>
      </div>

      <div class="grid grid-cols-1 gap-4">
        <div class="flex flex-col gap-2">
          <label for="userJson">User JSON</label>
          <div class="h-[12rem]">
            <ngx-monaco-editor style="width: 100%; height: 100%" [options]="editorOptions"
              formControlName="userJson"></ngx-monaco-editor>
          </div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="Status">Status</label>
          <p-select formControlName="active" optionLabel="name" optionValue="value" [options]="activeStatus"
            placeholder="Select Active status" class="w-full" />
        </div>
        <div class="flex flex-col gap-2">
          <label for="lastConnectionDate">Last Connection Date</label>
          <input pInputText id="lastConnectionDate" formControlName="lastConnectionDate"
            aria-describedby="username-help" />
        </div>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="lastRunDuration">Last Run Duration</label>
          <input pInputText id="lastRunDuration" formControlName="lastRunDuration" aria-describedby="username-help" />
        </div>
        <div class="flex flex-col gap-2">
          <label for="lastConnectionSts">Last Connection Status</label>
          <input pInputText id="lastConnectionSts" formControlName="lastConnectionSts"
            aria-describedby="username-help" />
        </div>
      </div>
    </form>
  </p-card>
  }
</div>